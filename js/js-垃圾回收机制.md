# JavaScript垃圾回收

js的垃圾回收主要分两种：标记清理和引用计数

## 标记清理

### 标记清理策略

- 1.当变量进入上下文，或者在函数内部声明一个变量时，会被加上进入上下文的标记；当变量离开上下文时会被加上离开上下文的标记
- 2.垃圾回收程序运行时，会标记内存中所有存储的变量，它会将所有在上下文中的变量，和该变量引用的其他变量的标记取消，这样在此之后再被加上标记的变量就是待回收的了，因为在任何的上下文中都访问不到该变量。

### 标记过程的实现

- 变量进入上下文时反转某一位。
- 维护进入上下文和离开上下文的两个变量列表。

## 引用计数

### 引用计数的策略

- 对每个值都记录它被引用的次数
- 当声明变量的时候并给该变量赋值为引用值（假设为 fObject）时，这个值(fObject)的引用数加1，如果同一个值(Object)又被赋值给另外一个变量时，这个值的引用数继续加1。类似的，如果保存该值引用的变量被其他值给覆盖了，那么引用数减1。垃圾回收程序会释放引用数为0的内存。

### 引用计数的问题

- 循环引用导致无法释放内出

```js
function problem() {
    let oA = new object();
    let oB = new object();
    oA.someOtherObject = oB;
    oB.anotherObject = oA;
}
```
